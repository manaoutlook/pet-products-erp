
> rest-express@1.0.0 dev
> tsx server/index.ts

Setting up admin user...
11:47:37 AM [express] serving on port 5000
Using role type: { id: 1, description: 'System Administrator' }
Admin role: {
  id: 1,
  name: 'admin',
  description: 'System Administrator Role',
  roleTypeId: 1,
  permissions: {
    users: { read: true, create: true, delete: true, update: true },
    orders: { read: true, create: true, delete: true, update: true },
    stores: { read: true, create: true, delete: true, update: true },
    products: { read: true, create: true, delete: true, update: true },
    inventory: { read: true, create: true, delete: true, update: true }
  },
  createdAt: 2025-03-06T11:03:33.642Z,
  updatedAt: 2025-03-06T11:03:33.642Z
}
Generated hash length: 96
Admin password updated successfully
User info request: { isAuthenticated: false, user: undefined }
11:47:41 AM [express] GET /api/user 401 in 2ms :: {"message":"Not logged in","suggestion":"Please log…
User info request: { isAuthenticated: false, user: undefined }
11:47:50 AM [express] GET /api/user 401 in 1ms :: {"message":"Not logged in","suggestion":"Please log…
Login request received: { username: 'admin', hasPassword: true }
Attempting login for user: admin
Found user, verifying password...
Login successful: {
  id: 2,
  username: 'admin',
  role: {
    id: 1,
    name: 'admin',
    permissions: {
      users: [Object],
      orders: [Object],
      stores: [Object],
      products: [Object],
      inventory: [Object]
    }
  }
}
Serializing user: {
  id: 2,
  username: 'admin',
  role: {
    id: 1,
    name: 'admin',
    permissions: {
      users: [Object],
      orders: [Object],
      stores: [Object],
      products: [Object],
      inventory: [Object]
    }
  }
}
Login successful: { userId: 2, username: 'admin', role: 'admin' }
11:47:57 AM [express] POST /api/login 200 in 1039ms :: {"message":"Login successful","user":{"id":2,"…
Deserializing user: {
  id: 2,
  username: 'admin',
  role: {
    id: 1,
    name: 'admin',
    permissions: {
      users: [Object],
      orders: [Object],
      stores: [Object],
      products: [Object],
      inventory: [Object]
    }
  }
}
User deserialized: {
  id: 2,
  username: 'admin',
  role: {
    id: 1,
    name: 'admin',
    permissions: {
      users: [Object],
      orders: [Object],
      stores: [Object],
      products: [Object],
      inventory: [Object]
    }
  }
}
User info request: {
  isAuthenticated: true,
  user: {
    id: 2,
    username: 'admin',
    role: { id: 1, name: 'admin', permissions: [Object] }
  }
}
11:47:57 AM [express] GET /api/user 304 in 230ms :: {"id":2,"username":"admin","role":{"id":1,"name":…
Deserializing user: {
  id: 2,
  username: 'admin',
  role: {
    id: 1,
    name: 'admin',
    permissions: {
      users: [Object],
      orders: [Object],
      stores: [Object],
      products: [Object],
      inventory: [Object]
    }
  }
}
User deserialized: {
  id: 2,
  username: 'admin',
  role: {
    id: 1,
    name: 'admin',
    permissions: {
      users: [Object],
      orders: [Object],
      stores: [Object],
      products: [Object],
      inventory: [Object]
    }
  }
}
User info request: {
  isAuthenticated: true,
  user: {
    id: 2,
    username: 'admin',
    role: { id: 1, name: 'admin', permissions: [Object] }
  }
}
11:47:57 AM [express] GET /api/user 304 in 229ms :: {"id":2,"username":"admin","role":{"id":1,"name":…
Deserializing user: {
  id: 2,
  username: 'admin',
  role: {
    id: 1,
    name: 'admin',
    permissions: {
      users: [Object],
      orders: [Object],
      stores: [Object],
      products: [Object],
      inventory: [Object]
    }
  }
}
User deserialized: {
  id: 2,
  username: 'admin',
  role: {
    id: 1,
    name: 'admin',
    permissions: {
      users: [Object],
      orders: [Object],
      stores: [Object],
      products: [Object],
      inventory: [Object]
    }
  }
}
GET /categories
Deserializing user: {
  id: 2,
  username: 'admin',
  role: {
    id: 1,
    name: 'admin',
    permissions: {
      users: [Object],
      orders: [Object],
      stores: [Object],
      products: [Object],
      inventory: [Object]
    }
  }
}
Deserializing user: {
  id: 2,
  username: 'admin',
  role: {
    id: 1,
    name: 'admin',
    permissions: {
      users: [Object],
      orders: [Object],
      stores: [Object],
      products: [Object],
      inventory: [Object]
    }
  }
}
11:47:58 AM [express] GET /api/categories 304 in 459ms :: [{"id":1,"name":"Accessories","description"…
User deserialized: {
  id: 2,
  username: 'admin',
  role: {
    id: 1,
    name: 'admin',
    permissions: {
      users: [Object],
      orders: [Object],
      stores: [Object],
      products: [Object],
      inventory: [Object]
    }
  }
}
GET /brands
User deserialized: {
  id: 2,
  username: 'admin',
  role: {
    id: 1,
    name: 'admin',
    permissions: {
      users: [Object],
      orders: [Object],
      stores: [Object],
      products: [Object],
      inventory: [Object]
    }
  }
}
GET /products
11:47:59 AM [express] GET /api/brands 304 in 1218ms :: [{"id":1,"name":"P-Link","description":"P-Link…
11:47:59 AM [express] GET /api/products 304 in 1271ms :: []
Deserializing user: {
  id: 2,
  username: 'admin',
  role: {
    id: 1,
    name: 'admin',
    permissions: {
      users: [Object],
      orders: [Object],
      stores: [Object],
      products: [Object],
      inventory: [Object]
    }
  }
}
User deserialized: {
  id: 2,
  username: 'admin',
  role: {
    id: 1,
    name: 'admin',
    permissions: {
      users: [Object],
      orders: [Object],
      stores: [Object],
      products: [Object],
      inventory: [Object]
    }
  }
}
POST /products
Error creating product: ReferenceError: insertProductSchema is not defined
    at <anonymous> (/home/runner/workspace/server/routes.ts:1468:22)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/runner/workspace/node_modules/express/lib/router/route.js:149:13)
    at <anonymous> (/home/runner/workspace/server/middleware.ts:18:5)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at next (/home/runner/workspace/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/home/runner/workspace/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at /home/runner/workspace/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/home/runner/workspace/node_modules/express/lib/router/index.js:346:12)
    at next (/home/runner/workspace/node_modules/express/lib/router/index.js:280:10)
    at requireAuth (/home/runner/workspace/server/middleware.ts:66:3)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at trim_prefix (/home/runner/workspace/node_modules/express/lib/router/index.js:328:13)
    at /home/runner/workspace/node_modules/express/lib/router/index.js:286:9
    at Function.process_params (/home/runner/workspace/node_modules/express/lib/router/index.js:346:12)
    at next (/home/runner/workspace/node_modules/express/lib/router/index.js:280:10)
    at <anonymous> (/home/runner/workspace/server/routes.ts:57:5)
    at Layer.handle [as handle_request] (/home/runner/workspace/node_modules/express/lib/router/layer.js:95:5)
    at trim_prefix (/home/runner/workspace/node_modules/express/lib/router/index.js:328:13)
    at /home/runner/workspace/node_modules/express/lib/router/index.js:286:9
    at Function.process_params (/home/runner/workspace/node_modules/express/lib/router/index.js:346:12)
    at next (/home/runner/workspace/node_modules/express/lib/router/index.js:280:10)
    at strategy.pass (/home/runner/workspace/node_modules/passport/lib/middleware/authenticate.js:355:9)
    at /home/runner/workspace/node_modules/passport/lib/strategies/session.js:120:12
    at pass (/home/runner/workspace/node_modules/passport/lib/authenticator.js:352:31)
    at deserialized (/home/runner/workspace/node_modules/passport/lib/authenticator.js:364:7)
    at <anonymous> (/home/runner/workspace/server/auth.ts:282:7)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
11:48:14 AM [express] POST /api/products 500 in 1016ms :: {"message":"Failed to create product","sugg…