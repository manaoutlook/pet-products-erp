deploy@ubuntu:/var/www/pet-products-erp$ npm run dev

> rest-express@1.0.0 dev
> tsx server/index.ts

/var/www/pet-products-erp/db/index.ts:22
  throw new Error(
        ^


Error: DATABASE_URL must be set. Did you forget to provision a database?
    at <anonymous> (/var/www/pet-products-erp/db/index.ts:22:9)
    at ModuleJob.run (node:internal/modules/esm/module_job:234:25)
    at async ModuleLoader.import (node:internal/modules/esm/loader:473:24)
    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:122:5)

Node.js v20.18.3
deploy@ubuntu:/var/www/pet-products-erp$ sudo cat .env
DATABASE_URL=postgresql://erp_user:your_strong_password@localhost:5432/pet_products_erp
SESSION_SECRET=#Pet#ERP#Products$Selling#
PORT=5001
NODE_ENV=production
REDIS_URL="redis://localhost:6379/0"
deploy@ubuntu:/var/www/pet-products-erp$ export DATABASE_URL=postgresql://erp_user:your_strong_password@localhost:5432/pet_products_erp
deploy@ubuntu:/var/www/pet-products-erp$ npm run dev

> rest-express@1.0.0 dev
> tsx server/index.ts

Setting up admin user...
1:52:18 PM [express] Port 5001 is in use, trying port 5002...
1:52:18 PM [express] Port 5001 is in use, trying port 5002...
1:52:18 PM [express] Port 5002 is in use, trying port 5003...
1:52:18 PM [express] serving on 0.0.0.0:5003
1:52:18 PM [express] DATABASE_URL configured: Yes
1:52:18 PM [express] serving on 0.0.0.0:5003
1:52:18 PM [express] DATABASE_URL configured: Yes
1:52:18 PM [express] serving on 0.0.0.0:5003
1:52:18 PM [express] DATABASE_URL configured: Yes
1:52:18 PM [express] serving on 0.0.0.0:5003
1:52:18 PM [express] DATABASE_URL configured: Yes
Error setting up admin user: ErrorEvent {
  [Symbol(kTarget)]: WebSocket {
    _events: [Object: null prototype] {
      error: [Function],
      message: [Function],
      close: [Function],
      open: [Function]
    },
    _eventsCount: 4,
    _maxListeners: undefined,
    _binaryType: 'arraybuffer',
    _closeCode: 1006,
    _closeFrameReceived: false,
    _closeFrameSent: false,
    _closeMessage: <Buffer >,
    _closeTimer: null,
    _errorEmitted: true,
    _extensions: {},
    _paused: false,
    _protocol: '',
    _readyState: 3,
    _receiver: null,
    _sender: null,
    _socket: null,
    _bufferedAmount: 0,
    _isServer: false,
    _redirects: 0,
    _autoPong: true,
    _url: 'wss://localhost/v2',
    _req: null,
    [Symbol(shapeMode)]: false,
    [Symbol(kCapture)]: false
  },
  [Symbol(kType)]: 'error',
  [Symbol(kError)]: Error [ERR_TLS_CERT_ALTNAME_INVALID]: Hostname/IP does not match certificate's altnames: Host: localhost. is not in the cert's altnames: DNS:carnew.sourceperfect.net
      at Object.checkServerIdentity (node:tls:316:12)
      at TLSSocket.onConnectSecure (node:_tls_wrap:1687:27)
      at TLSSocket.emit (node:events:518:28)
      at TLSSocket._finishInit (node:_tls_wrap:1076:8)
      at ssl.onhandshakedone (node:_tls_wrap:862:12) {
    code: 'ERR_TLS_CERT_ALTNAME_INVALID',
    reason: "Host: localhost. is not in the cert's altnames: DNS:carnew.sourceperfect.net",
    host: 'localhost',
    cert: {
      subject: [Object: null prototype],
      issuer: [Object: null prototype],
      subjectaltname: 'DNS:carnew.sourceperfect.net',
      infoAccess: [Object: null prototype],
      ca: false,
      bits: 256,
      pubkey: <Buffer 04 db 2e f5 e6 90 7f 73 17 0a 79 9d 7e 5c d0 5d 17 fd fc 7c ea 7b 18 6b c0 cf a5 b4 74 da ef a2 3e ad c6 0c ad 98 a2 6c 0b b8 39 8a 0d 86 f8 a5 ef c7 ... 15 more bytes>,
      asn1Curve: 'prime256v1',
      nistCurve: 'P-256',
      valid_from: 'Mar  5 07:14:40 2025 GMT',
      valid_to: 'Jun  3 07:14:39 2025 GMT',
      fingerprint: '0E:AB:15:30:F6:95:C9:A4:3C:7B:43:80:80:2B:F7:E4:B3:BE:AF:79',
      fingerprint256: '85:0D:4D:A0:C7:7C:C4:A8:5D:15:12:E1:FA:AD:A7:3F:1D:FE:29:9F:49:37:E9:8B:3B:3E:D2:40:D5:AA:77:FA',
      fingerprint512: 'EA:5C:AE:9C:03:D9:AB:A1:B9:EC:2C:93:06:3A:3D:20:8B:30:EF:FB:3C:CA:57:07:A0:86:93:E3:87:AB:DD:63:55:C9:E2:D3:A6:64:56:C9:45:B7:8B:2D:84:A6:CA:2C:87:46:CC:C7:1B:26:6C:90:20:19:D0:3F:60:1B:49:33',
      ext_key_usage: [Array],
      serialNumber: '0360431C24D22178DB2AB20F4DDC5012C106',
      raw: <Buffer 30 82 03 91 30 82 03 18 a0 03 02 01 02 02 12 03 60 43 1c 24 d2 21 78 db 2a b2 0f 4d dc 50 12 c1 06 30 0a 06 08 2a 86 48 ce 3d 04 03 03 30 32 31 0b 30 ... 867 more bytes>,
      issuerCertificate: [Object]
    }
  },
  [Symbol(kMessage)]: "Hostname/IP does not match certificate's altnames: Host: localhost. is not in the cert's altnames: DNS:carnew.sourceperfect.net"
}
ErrorEvent {
  [Symbol(kTarget)]: WebSocket {
    _events: [Object: null prototype] {
      error: [Function],
      message: [Function],
      close: [Function],
      open: [Function]
    },
    _eventsCount: 4,
    _maxListeners: undefined,
    _binaryType: 'arraybuffer',
    _closeCode: 1006,
    _closeFrameReceived: false,
    _closeFrameSent: false,
    _closeMessage: <Buffer >,
    _closeTimer: null,
    _errorEmitted: true,
    _extensions: {},
    _paused: false,
    _protocol: '',
    _readyState: 3,
    _receiver: null,
    _sender: null,
    _socket: null,
    _bufferedAmount: 0,
    _isServer: false,
    _redirects: 0,
    _autoPong: true,
    _url: 'wss://localhost/v2',
    _req: null,
    [Symbol(shapeMode)]: false,
    [Symbol(kCapture)]: false
  },
  [Symbol(kType)]: 'error',
  [Symbol(kError)]: Error [ERR_TLS_CERT_ALTNAME_INVALID]: Hostname/IP does not match certificate's altnames: Host: localhost. is not in the cert's altnames: DNS:carnew.sourceperfect.net
      at Object.checkServerIdentity (node:tls:316:12)
      at TLSSocket.onConnectSecure (node:_tls_wrap:1687:27)
      at TLSSocket.emit (node:events:518:28)
      at TLSSocket._finishInit (node:_tls_wrap:1076:8)
      at ssl.onhandshakedone (node:_tls_wrap:862:12) {
    code: 'ERR_TLS_CERT_ALTNAME_INVALID',
    reason: "Host: localhost. is not in the cert's altnames: DNS:carnew.sourceperfect.net",
    host: 'localhost',
    cert: {
      subject: [Object: null prototype],
      issuer: [Object: null prototype],
      subjectaltname: 'DNS:carnew.sourceperfect.net',
      infoAccess: [Object: null prototype],
      ca: false,
      bits: 256,
      pubkey: <Buffer 04 db 2e f5 e6 90 7f 73 17 0a 79 9d 7e 5c d0 5d 17 fd fc 7c ea 7b 18 6b c0 cf a5 b4 74 da ef a2 3e ad c6 0c ad 98 a2 6c 0b b8 39 8a 0d 86 f8 a5 ef c7 ... 15 more bytes>,
      asn1Curve: 'prime256v1',
      nistCurve: 'P-256',
      valid_from: 'Mar  5 07:14:40 2025 GMT',
      valid_to: 'Jun  3 07:14:39 2025 GMT',
      fingerprint: '0E:AB:15:30:F6:95:C9:A4:3C:7B:43:80:80:2B:F7:E4:B3:BE:AF:79',
      fingerprint256: '85:0D:4D:A0:C7:7C:C4:A8:5D:15:12:E1:FA:AD:A7:3F:1D:FE:29:9F:49:37:E9:8B:3B:3E:D2:40:D5:AA:77:FA',
      fingerprint512: 'EA:5C:AE:9C:03:D9:AB:A1:B9:EC:2C:93:06:3A:3D:20:8B:30:EF:FB:3C:CA:57:07:A0:86:93:E3:87:AB:DD:63:55:C9:E2:D3:A6:64:56:C9:45:B7:8B:2D:84:A6:CA:2C:87:46:CC:C7:1B:26:6C:90:20:19:D0:3F:60:1B:49:33',
      ext_key_usage: [Array],
      serialNumber: '0360431C24D22178DB2AB20F4DDC5012C106',
      raw: <Buffer 30 82 03 91 30 82 03 18 a0 03 02 01 02 02 12 03 60 43 1c 24 d2 21 78 db 2a b2 0f 4d dc 50 12 c1 06 30 0a 06 08 2a 86 48 ce 3d 04 03 03 30 32 31 0b 30 ... 867 more bytes>,
      issuerCertificate: [Object]
    }
  },
  [Symbol(kMessage)]: "Hostname/IP does not match certificate's altnames: Host: localhost. is not in the cert's altnames: DNS:carnew.sourceperfect.net"
}

